#!/usr/bin/env bash
# SENTINEL Lazy Loading Configuration
# This file defines which modules should be lazy loaded vs eagerly loaded

# Global lazy loading toggle (set to 0 to disable lazy loading entirely)
export SENTINEL_LAZY_LOADING_ENABLED=1

# Core modules that should always be loaded eagerly (essential for shell operation)
# These modules provide core functionality and are lightweight
SENTINEL_CORE_MODULES=(
    "blesh_installer"      # Enhanced line editor - needs to be loaded early
    "autocomplete"         # Tab completion - essential for usability
    "logging"              # System logging - needed for audit trail
    "shell_security"       # Security features - should always be active
    "config_cache"         # Configuration caching - improves performance
    "module_manager"       # Module management - needed for module system
    "bash_logout"          # Logout handling - needed for cleanup
    "command_chains"       # Command chaining support
    "fuzzy_correction"     # Typo correction - lightweight and useful
    "fzf"                  # Fuzzy finder - commonly used
)

# Heavy modules that should be lazy loaded (loaded on first use)
# These modules have significant startup cost or dependencies
SENTINEL_LAZY_LOAD_MODULES=(
    # ML/AI modules - require Python and various libraries
    "sentinel_ml"          # Machine learning suggestions
    "sentinel_ml_enhanced" # Enhanced ML features
    "sentinel_context"     # Context awareness
    "sentinel_markov"      # Markov chain generation
    "sentinel_smallllm"    # Small LLM integration
    
    # Security/Analysis modules - heavy dependencies
    "sentinel_osint"       # OSINT tools - loads many Python libs
    "sentinel_cybersec_ml" # Cybersecurity ML - requires models
    "hashcat"              # Password cracking - external tool
    "obfuscate"            # Code obfuscation - complex operations
    
    # Interactive modules - not needed until explicitly used
    "sentinel_chat"        # LLM chat interface
    "sentinel_gitstar"     # GitHub star analysis
    
    # Development tools - only needed in specific contexts
    "distcc"               # Distributed compilation
    "project_suggestions"  # Project-specific suggestions
)

# Per-module overrides (uncomment to force specific behavior)
# export SENTINEL_SENTINEL_ML_LAZY_LOAD=1      # Force lazy loading
# export SENTINEL_FZF_LAZY_LOAD=0              # Force eager loading

# Lazy loading behavior configuration
export SENTINEL_LAZY_SHOW_LOADING=1           # Show message when lazy loading
export SENTINEL_LAZY_PRELOAD_ON_IDLE=0        # Preload modules when shell is idle
export SENTINEL_LAZY_CACHE_TIMEOUT=3600       # Cache loaded state for 1 hour

# Custom proxy commands for lazy modules
# These commands will trigger loading of their respective modules
declare -A SENTINEL_LAZY_COMMANDS
SENTINEL_LAZY_COMMANDS=(
    ["ml"]="sentinel_ml"
    ["ml_suggest"]="sentinel_ml"
    ["osint"]="sentinel_osint"
    ["chat"]="sentinel_chat"
    ["gitstar"]="sentinel_gitstar"
    ["hashcat_helper"]="hashcat"
    ["obfuscate"]="obfuscate"
)